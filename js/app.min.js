"use strict";var _={id:function(e){return _.isString(e)?document.getElementById(e):(console.error("No valid selector given."),null)},class:function(e,t){return _.isString(e)?(void 0===t&&(t=document),_.isElement(t)?t.getElementsByClassName(e):(console.error("The context given is not a HTML element."),null)):(console.error("No valid selector given."),null)},tag:function(e,t){return _.isString(e)?(void 0===t&&(t=document),_.isElement(t)?t.getElementsByTagName(e):(console.error("The context given is not a HTML element."),null)):(console.error("No valid selector given."),null)},select:function(e,t,n){if(!_.isString(e))return console.error("No valid selector given."),null;if(void 0===t&&(t=document),!_.isElement(t))return console.error("The context given is not a HTML element."),null;if(/^(#|\.)?[\w\-]+$/.test(e)){switch(e.charAt(0)){case"#":return[t.getElementById(e.substr(1))];case".":return t.getElementsByClassName(e.substr(1).replace(/\./g," "))}return t.getElementsByTagName(e)}if(t.querySelectorAll)return t.querySelectorAll(e);_.isFunction(n)&&n()},contains:function(e,t){return _.isElement(e)?_.isElement(t)?e!=t&&e.contains(t):(console.error("No valid child HTML element given."),null):(console.error("No valid parent HTML element given."),null)},create:function(e,t){if(!_.isString(e))return console.error("No string given.");if(void 0!==t){if(!_.isObject(t))return console.error("The settings given as a parameter have to be an object.")}else t={};var n=e.match(/#[^\.#\s]+/g),i=e.match(/\.[^#\s\.]+/g),r=document.createElement(e.replace(/#[^\.#\s]+|\.[^#\s]+|\s/g,""));for(var a in n&&(r.id=n[0].replace(/#/,"")),i&&(r.className=i.join(" ").replace(/\./g,"")),t)if(t.hasOwnProperty.call(t,a))switch(a){case"innerHTML":r.innerHTML=t[a];break;case"style":for(var o in t[a])r.style.setProperty(o,t[a][o]);break;default:r.setAttribute(a,t[a])}return r},append:function(e,t){return _.isElement(e)?_.isElement(t)||_.isNumber(t)||_.isString(t)?((_.isString(t)||_.isNumber(t))&&(t=document.createTextNode(t)),void e.appendChild(t)):console.error("Second given parameter is neither a HTML element, text or a number."):console.error("First given element does not exist.")},prepend:function(e,t){return _.isElement(e)?_.isElement(t)||_.isNumber(t)||_.isString(t)?((_.isString(t)||_.isNumber(t))&&(t=document.createTextNode(t)),void e.insertBefore(t,e.childNodes[0])):console.error("Second given parameter is neither a HTML element, text or a number."):console.error("First given element does not exist.")},after:function(e,t){return _.isElement(e)?_.isElement(t)||_.isNumber(t)||_.isString(t)?((_.isString(t)||_.isNumber(t))&&(t=document.createTextNode(t)),void e.parentNode.insertBefore(t,e.nextSibling)):console.error("Second given parameter is neither a HTML element, text or a number."):console.error("First given element does not exist.")},before:function(e,t){return _.isElement(e)?_.isElement(t)||_.isNumber(t)||_.isString(t)?((_.isString(t)||_.isNumber(t))&&(t=document.createTextNode(t)),void e.insertBefore(t,e)):console.error("Second given parameter is neither a HTML element, text or a number."):console.error("First given element does not exist.")},remove:function(e){_.isElement(e)&&e.parentNode.removeChild(e)},empty:function(e){if(!_.isElement(e))return console.error("Element does not exist.");e.innerHTML=""},addEvent:function(e,t,n,i){return _.isElement(e)||e instanceof Window?_.isString(t)?_.isFunction(n)?(!0!==i&&(i=!1),void("addEventListener"in e?e.addEventListener(t,n,i):e.attachEvent("on"+t,n))):console.error("No function was given."):console.error("No event name was given."):console.error("Element does not exist.")},removeEvent:function(e,t,n,i){return _.isElement(e)?_.isString(t)?_.isFunction(n)?(!0!==i&&(i=!1),void("removeEventListener"in e?e.removeEventListener(t,n,i):e.detachEvent("on"+t,n))):console.error("No function was given."):console.error("No event name was given."):console.error("Element does not exist.")},onClick:function(e,t,n){_.addEvent(e,"click",t,n)},removeClick:function(e,t,n){_.removeEvent(e,"click",t,n)},onInput:function(e,t,n){_.addEvent(e,"input",t,n)},removeInput:function(e,t,n){_.removeEvent(e,"input",t,n)},onLoad:function(e,t,n){_.addEvent(e,"load",t,n)},removeLoad:function(e,t,n){_.removeEvent(e,"load",t,n)},target:function(e){return _.exists(e)?e.target||e.srcElement:console.error("No valid event given.")},preventDefault:function(e){e.preventDefault(),e.stopPropagation()},addClass:function(e,t){return _.isElement(e)?_.isString(t)?void("classList"in e?e.classList.add(t):-1==e.className.split(" ").indexOf(t)&&(e.className+=" "+t)):console.error("No class name was given."):console.error("Element does not exist.")},removeClass:function(e,t){return _.isElement(e)?_.isString(t)?void("classList"in e?e.classList.remove(t):e.className=e.className.replace(new RegExp("\b"+_.escapeRegex(t)+"\b","g")," ")):console.error("No class name was given."):console.error("Element does not exist.")},toggleClass:function(e,t){return _.isElement(e)?_.isString(t)?void(_.hasClass(e,t)?_.removeClass(e,t):_.addClass(e,t)):console.error("No class name was given."):console.error("Element does not exist.")},hasClass:function(e,t){return _.isElement(e)?_.isString(t)?"classList"in e?e.classList.contains(t):-1!=e.className.split(" ").indexOf(t):console.error("No class name was given."):console.error("Element does not exist.")},getStyle:function(e,t){return _.isElement(e)?_.isString(t)?"getComputedStyle"in window?window.getComputedStyle(e,null).getPropertyValue(t):"currentStyle"in e?e.currentStyle[t]:void 0:console.error("Given style is not a string."):console.error("Element is not defined.")},setStyles:function(e,t){if(!_.isElement(e))return console.error("Element is not defined.");if(!_.isObject(t))return console.error("No valid styles object given.");for(var n in t)e.style.setProperty(n,t[n])},getHeight:function(e){if(!_.isElement(e))return console.error("Element is not defined.");var t=e.getBoundingClientRect();return t.bottom-t.top},getWidth:function(e){if(!_.isElement(e))return console.error("Element is not defined.");var t=e.getBoundingClientRect();return t.right-t.left},exists:function(e){return null!=e},isElement:function(e){return e instanceof Element||e instanceof HTMLDocument},isElementInDOM:function(e){return!!_.isElement(e)&&document.documentElement.contains(e)},isNodelist:function(e){return NodeList.prototype.isPrototypeOf(e)},isHTMLCollection:function(e){return HTMLCollection.prototype.isPrototypeOf(e)},isFunction:function(e){return"function"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isArray:function(e){return null!=e&&e.constructor===Array},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isInteger:function(e){return"number"==typeof e&&e%1==0},isFloat:function(e){return"number"==typeof e&&e%1!=0},escapeRegex:function(e){return _.isString(class_)?(""+e).replace(/[\.\*\+\?\^\$\{\}\(\)\|\[\]\\\/\-]/g,"\\$&"):console.error("No string was given.")},encodeHTML:function(e){return _.isString(e)?(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):console.error("No string was given.")},decodeHTML:function(e){return _.isString(class_)?(""+e).replace(/\&amp\;/g,"&").replace(/\&lt\;/g,"<").replace(/\&gt\;/g,">").replace(/\&quot\;/g,'"').replace(/\&#039\;/g,"'"):console.error("No string was given.")},escapeDoubleQuotes:function(e){return e.replace(/\\([\s\S])|(")/g,"\\$1$2")},parseJSON:function(e){if(!_.isString(e))return console.error("No string was given.");var t=null;try{t=JSON.parse(e)}catch(e){console.error("Could not parse the given string as JSON, because of a "+e)}return t},getMean:function(e){for(var t=0,n=e.length,i=0;i<n;i++)t+=e[i];return t/n},getMin:function(e,t){for(var n=_.isNumber(t)?t:Number.MAX_VALUE,i=e.length,r=0;r<i;r++){var a=e[r];a<n&&(n=a)}return n},getMax:function(e,t){for(var n=_.isNumber(t)?t:Number.MIN_VALUE,i=e.length,r=0;r<i;r++){var a=e[r];n<a&&(n=a)}return n},limitNumber:function(e,t,n,i){return e<t?(e=t,_.isFunction(i)&&i(t)):n<e&&(e=n,_.isFunction(i)&&i(n)),e},truncate:function(e){return _.isNumber(e)?e<0?Math.ceil(e):Math.floor(e):(console.error("No number given."),e)},sortArrayObjects:function(e,n,t){return t?e.sort(function(e,t){return e[n]<t[n]?1:-1}):e.sort(function(e,t){return e[n]>t[n]?1:-1})},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty.call(e,t))return!1;return JSON.stringify(e)===JSON.stringify({})},removeArrayIndex:function(e,t){for(var n=e.length,i=t;i<n-1;i++)e[i]=e[i+1];return e.pop(),e},getObjectSize:function(e){return Object.keys(e).length}},NODE={html:_.tag("html")[0],head:_.tag("head")[0],body:_.tag("body")[0],data_load_btn:_.id("load-data"),darkmode_btn:_.id("toggle-darkmode"),play_btn:_.id("play-button"),pause_btn:_.id("pause-button"),stop_btn:_.id("stop-button"),speed_selection:{container_1:_.id("pre-defined-speed"),container_2:_.id("custom-speed"),input:_.id("custom-speed-input"),custom:_.id("open-custom-speed-menu"),close_custom:_.id("close-custom-speed-menu")},speed_btn:{slow:_.id("half-speed"),normal:_.id("normal-speed"),fast:_.id("double-speed")},data_load:{window:_.id("data-load-window"),close_btn:null,blur:null,drop_area:_.id("drop-area"),select_file_input:_.id("selected-file"),example_sets_area:_.id("example-set-area"),notice:_.id("file-reader-notice")},initializeDataLoadWindow:function(){var e=this.data_load;e.close_btn=_.class("close",e.window)[0],e.blur=_.class("blur",e.window)[0],delete this.initializeDataLoadWindow},compare_items:{window:_.id("compare-items-window"),close_btn:null,blur:null,unselected_area:null,selected_area:null},initializeCompareItemsWindow:function(){var e=this.compare_items;e.close_btn=_.class("close",e.window)[0],e.blur=_.class("blur",e.window)[0],e.unselected_area=_.class("unselected-area",e.window)[0],e.selected_area=_.class("selected-area",e.window)[0],delete this.initializeCompareItemsWindow},chart_container_1:_.id("chart-container-1"),current_value:{container:_.id("data-set-current-value"),value:null,indicator:null},data_set_info:{title:null,date:null},bar_chart:_.id("bar-chart"),ratio_chart_total:_.id("ratio-total"),ratio_chart_container:_.id("ratio-chart"),ratio_chart:null,initializeBarChart:function(){var e=_.id("data-set-info");this.data_set_info.title=_.class("title",e)[0],this.data_set_info.date=_.class("date",e)[0];var t=this.current_value;t.value=_.class("value",t.container)[0],t.indicator=_.class("indicator",t.container)[0],this.ratio_chart=_.tag("tr",this.ratio_chart_container)[0],delete this.initializeBarChart},chart_container_2:_.id("chart-container-2"),line_chart:_.id("line-chart"),line_chart_menu:_.id("line-chart-menu"),close_line_chart_btn:_.id("close-line-chart"),download_png_btn:_.id("download-line-chart"),compare_btn:_.id("compare-btn"),initialize:function(){this.initializeDataLoadWindow(),this.initializeBarChart(),this.initializeCompareItemsWindow(),delete this.initialize}},MSG={type:{NORMAL:"normal",ERROR:"error",WARNING:"warning"},element:void 0,close_timer:null,hide_animation_timer:null,generateHTML:function(e,t){return _.create("div#overlay-message."+t,{innerHTML:_.encodeHTML(e)})},show:function(e,t,n){if(MSG.hide(),_.isNumber(t)||(t=3500),t<800)return console.error("Message must appear for at least 400ms.");void 0===n&&(n=MSG.type.NORMAL),MSG.element=MSG.generateHTML(e,n),_.append(NODE.html,MSG.element),MSG.close_timer=setTimeout(MSG.hide,t),MSG.hide_animation_timer=setTimeout(function(){_.addClass(MSG.element,"hide")},t-200)},error:function(e,t){MSG.show(e,t,MSG.type.ERROR)},warn:function(e,t){MSG.show(e,t,MSG.type.WARNING)},hide:function(){clearTimeout(MSG.close_timer),clearTimeout(MSG.hide_animation_timer),_.isElement(MSG.element)&&(_.remove(MSG.element),MSG.element=void 0)}},NAV={darkmode:!1,line_chart_opened:!1,initialize:function(){_.onClick(NODE.data_load_btn,DATA_LOAD.openWindow),_.onClick(NODE.darkmode_btn,this.toggleDarkMode),_.onClick(NODE.play_btn,ANIMATOR.play),_.onClick(NODE.pause_btn,ANIMATOR.pause),_.onClick(NODE.stop_btn,ANIMATOR.stop),_.onClick(NODE.speed_btn.slow,NAV.setSpeed),_.onClick(NODE.speed_btn.normal,NAV.setSpeed),_.onClick(NODE.speed_btn.fast,NAV.setSpeed),_.addEvent(NODE.speed_selection.input,"input",NAV.setCustomSpeed),_.onClick(NODE.speed_selection.custom,NAV.showCustomSpeedMenu),_.onClick(NODE.speed_selection.close_custom,NAV.showDefinedSpeedMenu),_.onClick(NODE.close_line_chart_btn,NAV.showBarChart),_.onClick(NODE.download_png_btn,NAV.downloadLineChart),_.onClick(NODE.compare_btn,COMPARE_ITEMS.openWindow)},toggleDarkMode:function(){NAV.darkmode=!NAV.darkmode,_[(NAV.darkmode?"add":"remove")+"Class"](NODE.html,"darkMode"),MSG.show("Toggled dark mode.",1300),ANIMATOR.refreshFrame()},enableButton:function(e){_.addClass(e,"active"),e.setAttribute("aria-disabled","false"),e.setAttribute("originalTabIndex",e.getAttribute("tabIndex")),e.setAttribute("tabIndex","-1")},disableButton:function(e){_.removeClass(e,"active"),e.setAttribute("aria-disabled","true");var t=e.getAttribute("originalTabIndex");null==t&&(t=e.getAttribute("tabIndex"),e.setAttribute("originalTabIndex",t)),e.setAttribute("tabIndex",t)},onlyEnableButton:function(e){var t=NODE.speed_btn;for(var n in t)t[n]===e?this.enableButton(t[n]):this.disableButton(t[n])},showBarChart:function(){NAV.line_chart_opened=!1,_.addClass(NODE.chart_container_1,"active"),_.removeClass(NODE.chart_container_2,"active"),ANIMATOR.refreshFrame()},showLineChart:function(){NAV.line_chart_opened=!0,_.removeClass(NODE.chart_container_1,"active"),_.addClass(NODE.chart_container_2,"active"),ANIMATOR.refreshFrame()},setSpeed:function(e){var t=_.target(e);if(!_.hasClass(t,"active")){NAV.onlyEnableButton(t);var n=1;switch(t.id){case"half-speed":n=.5;break;case"double-speed":n=2}MSG.show("Set speed to "+n+".",900),ANIMATOR.setSpeed(n)}},setCustomSpeed:function(e){var t=_.target(e),n=t.value;if(n.match(/[,]+/)&&(n=n.replace(/[,]+/,"."),t.value=n),n.match(/[^0-9\.]+/)&&(n=n.replace(/[^0-9\.]+/,""),t.value=n),n.match(/^([0-9]+|[0-9]+\.[0-9]+)$/)){if((n=parseFloat(n))%1!=0&&(n=n.toFixed(1)),n<.1||4<n)return MSG.error("Speed must be between 0.1 and 4."),void _.removeClass(t,"correct-speed");_.addClass(t,"correct-speed"),2<n&&MSG.warn("High speed values may produce lag."),ANIMATOR.setSpeed(n),(n+="")!=t.value&&(t.value=n)}else _.removeClass(t,"correct-speed")},showCustomSpeedMenu:function(){_.removeClass(NODE.speed_selection.container_1,"active"),_.addClass(NODE.speed_selection.container_2,"active");var e=NODE.speed_selection.input;e.value=ANIMATOR.speed+"",_.addClass(e,"correct-speed")},showDefinedSpeedMenu:function(){_.addClass(NODE.speed_selection.container_1,"active"),_.removeClass(NODE.speed_selection.container_2,"active");var e=0;e=_.hasClass(NODE.speed_btn.slow,"active")?.5:_.hasClass(NODE.speed_btn.normal,"active")?1:2,ANIMATOR.setSpeed(e)},downloadLineChart:function(){var e=NODE.line_chart.toDataURL("image/png"),t=new Date,n=t.getDate(),i=t.getMonth()+1,r=(9<n?"":"0")+n+"-"+(9<i?"":"0")+i+"-"+t.getFullYear()+" "+t.getHours()+"-"+t.getMinutes()+"-"+t.getSeconds(),a="chart "+COMPARE_ITEMS.ids[0].replace(/[^a-z0-9\-\_]/g,"")+" "+r+".png",o=_.create("a",{download:a,href:e});_.append(NODE.body,o),o.click(),_.remove(o),MSG.show("Downloaded image.",1300)}},DATA_LOAD={initialize:function(){var e=NODE.data_load;_.onClick(e.blur,this.closeWindow),_.onClick(e.close_btn,this.closeWindow);for(var t=_.tag("button",e.example_sets_area),n=t.length,i=0;i<n;i++)_.onClick(t[i],function(e){var t=_.target(e).getAttribute("load-data");FILE.loadURL("data/"+t+".json",!0)});_.isFunction(window.FileReader)||_.addClass(e.notice,"show"),_.addEvent(e.drop_area,"dragenter",_.preventDefault),_.addEvent(e.drop_area,"dragover",_.preventDefault),_.addEvent(e.drop_area,"dragleave",_.preventDefault),_.addEvent(e.drop_area,"drop",_.preventDefault),_.addEvent(e.drop_area,"dragenter",this.highlightDropArea),_.addEvent(e.drop_area,"dragover",this.highlightDropArea),_.addEvent(e.drop_area,"dragleave",this.unhighlightDropArea),_.addEvent(e.drop_area,"drop",this.unhighlightDropArea),_.addEvent(e.drop_area,"drop",function(e){var t=DATA_LOAD.getDroppedFile(e);FILE.process(t)}),_.addEvent(e.select_file_input,"change",function(){var e=this.files[0];FILE.process(e)})},openWindow:function(){_.addClass(NODE.data_load.window,"visible"),setTimeout(function(){NODE.data_load.close_btn.focus()},100)},closeWindow:function(){_.removeClass(NODE.data_load.window,"visible"),_.removeClass(NODE.data_load.window,"file-selected"),NODE.data_load_btn.focus()},highlightDropArea:function(){_.addClass(NODE.data_load.drop_area,"dragged-over")},unhighlightDropArea:function(){_.removeClass(NODE.data_load.drop_area,"dragged-over")},getDroppedFile:function(e){_.preventDefault(e);var t=!!e.dataTransfer.items,n=e.dataTransfer[t?"items":"files"],i=null;if(!(1<n.length)){if(t){if("file"!==n[0].kind)return void MSG.error("Do only drop files!");i=n[0].getAsFile()}else i=n[0];return i}MSG.error("Do not drop multiple files!")}},COMPARE_ITEMS={ids:[],id_num:0,setItemIds:function(e){COMPARE_ITEMS.ids=e,COMPARE_ITEMS.id_num=e.length},addItemId:function(e){COMPARE_ITEMS.hasItemId(e)||(COMPARE_ITEMS.ids[COMPARE_ITEMS.id_num]=e,COMPARE_ITEMS.id_num++)},removeItemId:function(e){for(var t=[],n=0;n<COMPARE_ITEMS.id_num;n++)COMPARE_ITEMS.ids[n]===e&&(t[t.length]=n);var i=t.length;for(n=0;n<i;n++)COMPARE_ITEMS.ids=_.removeArrayIndex(COMPARE_ITEMS.ids,t[n]),COMPARE_ITEMS.id_num--},hasItemId:function(e){for(var t=0;t<COMPARE_ITEMS.id_num;t++)if(COMPARE_ITEMS.ids[t]===e)return!0;return!1},resetItemIds:function(){COMPARE_ITEMS.ids=[],COMPARE_ITEMS.id_num=0},initialize:function(){_.onClick(NODE.compare_btn,this.openWindow),_.onClick(NODE.compare_items.blur,this.closeWindow),_.onClick(NODE.compare_items.close_btn,this.closeWindow)},openWindow:function(){void 0===COMPARE_ITEMS.HAVE_CREATED_BUTTONS&&(COMPARE_ITEMS.createButtons(),COMPARE_ITEMS.HAVE_CREATED_BUTTONS=!0),_.addClass(NODE.compare_items.window,"visible"),COMPARE_ITEMS.orderButtons(),setTimeout(function(){NODE.compare_items.close_btn.focus()},100)},closeWindow:function(){_.removeClass(NODE.compare_items.window,"visible"),NODE.compare_btn.focus()},buttons:[],buttons_num:0,createButtons:function(){for(var e in _.empty(NODE.compare_items.selected_area),_.empty(NODE.compare_items.unselected_area),DATA.items){var t=DATA.items[e],n=_.create("button.comparison-item",{"item-id":e,innerHTML:t.name,style:{background:t.color}});_.onClick(n,COMPARE_ITEMS.moveButton),COMPARE_ITEMS.buttons[COMPARE_ITEMS.buttons_num]=n,COMPARE_ITEMS.buttons_num++}COMPARE_ITEMS.orderButtons()},orderButtons:function(){for(var e=0;e<COMPARE_ITEMS.buttons_num;e++){for(var t=COMPARE_ITEMS.buttons[e],n=t.getAttribute("item-id"),i=!1,r=0;r<COMPARE_ITEMS.id_num;r++)if(COMPARE_ITEMS.ids[r]===n){i=!0;break}i?_.append(NODE.compare_items.selected_area,t):_.append(NODE.compare_items.unselected_area,t)}},moveButton:function(e){var t=_.target(e),n=t.getAttribute("item-id"),i=!1;t.parentElement===NODE.compare_items.unselected_area&&(i=!0),i?(COMPARE_ITEMS.addItemId(n),_.append(NODE.compare_items.selected_area,t)):(COMPARE_ITEMS.removeItemId(n),_.append(NODE.compare_items.unselected_area,t)),ANIMATOR.refreshFrame()}},DATA={name:"",date:"",items:{},item_num:0,html:{},from:0,to:0,original:{},fixed:{},fixed_num:0,upscaled:{},upscaled_num:0,formatted:{},max:{},min:{},mean:{},total:[],total_formatted:[],total_max:[],total_min:[],total_mean:[],set:function(e){DATA.name=e.name,DATA.date=e.date,DATA.setItems(e.items),DATA.setRange(e.range.from,e.range.to),DATA.setDataPoints(e.data),DATA.calculateStatistics()},setItems:function(e){for(var t in DATA.items={},DATA.item_num=0,e)if(e.hasOwnProperty.call(e,t)){var n="";_.isString(typeof e[t].icon)&&(n=_.encodeHTML(e[t].icon)),DATA.items[t]={},DATA.items[t].name=_.encodeHTML(e[t].name),DATA.items[t].name_escaped=_.escapeDoubleQuotes(e[t].name),DATA.items[t].icon=n,DATA.items[t].color=DATA.getItemColor(DATA.item_num),DATA.items[t].position=DATA.item_num,DATA.item_num++}},setRange:function(e,t){this.from=e,this.to=t,ANIMATOR.tick=0},setDataPoints:function(e){DATA.original=e,DATA.calculateFixedData(),DATA.calculateUpscaledData()},getMax:function(e){return DATA.max[e]},getMin:function(e){return DATA.min[e]},getMean:function(e){return DATA.mean[e]},getTotalMax:function(e){return DATA.total_max[e]},getTotalMin:function(e){return DATA.total_min[e]},getTotalMean:function(e){return DATA.total_mean[e]},calculateFixedData:function(){DATA.fixed={},DATA.fixed_num=0;var e=DATA.original,t={};for(var n in e)if(e.hasOwnProperty.call(e,n)){t[n]=[];for(var i=e[n],r=-1,a=DATA.from;a<=DATA.to;a++)if(r++,void 0===i[a+""])if(a!=DATA.from){for(var o=t[n][r-1],s=null,l=0,d=a+1;d<=DATA.to;d++)if(l++,void 0!==i[d+""]){s=i[d+""];break}if(null!=s){var c=o+(s-o)/(1+l);t[n][r]=c}else t[n][r]=o}else t[n][r]=0;else{var u=i[a+""];t[n][r]=u}}DATA.fixed=t,DATA.fixed_num=Math.abs(DATA.to-DATA.from)+1},calculateUpscaledData:function(){DATA.upscaled={},DATA.formatted={};var e=DATA.upscaled_num=0,t={},n={};for(var i in DATA.fixed)if(DATA.fixed.hasOwnProperty.call(DATA.fixed,i)){t[i]=[],n[i]=[];for(var r=DATA.fixed[i],a=-1,o=0;o<DATA.fixed_num;o++){a++;var s=r[o];if(t[i][a]=s,n[i][a]=DATA.formatNumber(s),o==DATA.fixed_num-1)break;for(var l=(r[o+1]-s)/100,d=2;d<=98;d+=2){a++;var c=s+d*l;t[i][a]=c,n[i][a]=DATA.formatNumber(c)}}0==e&&(e=1,DATA.upscaled_num=t[i].length)}DATA.upscaled=t,DATA.formatted=n},calculateStatistics:function(){for(var e in DATA.max={},DATA.min={},DATA.mean={},DATA.fixed)if(DATA.fixed.hasOwnProperty.call(DATA.fixed,e)){var t=DATA.fixed[e],n=_.getMax(t);DATA.max[e]={value:n,formatted:DATA.formatNumber(n)};var i=_.getMin(t);DATA.min[e]={value:i,formatted:DATA.formatNumber(i)};var r=Number(_.getMean(t).toFixed(3));DATA.mean[e]={value:r,formatted:DATA.formatNumber(r)}}DATA.total=[],DATA.total_formatted=[],DATA.total_max=[],DATA.total_min=[],DATA.total_mean=[];for(var a=0;a<DATA.upscaled_num;a++){var o=0;n=Number.MIN_VALUE,i=Number.MAX_VALUE;for(var s in DATA.upscaled){var l=DATA.upscaled[s][a];n<l&&(n=l),l<i&&(i=l),o+=l}DATA.total[a]=o,DATA.total_formatted[a]=DATA.formatNumber(o),DATA.total_max[a]=n,DATA.total_min[a]=i,DATA.total_mean[a]=Number((o/DATA.upscaled_num).toFixed(3))}},getItemColor:function(e){var t=["#099b9b","#a52a2a","#9f8605","#556b2f","#8b008b","#1616ad","#bf775f","#888236","#5ebf5e","#9932cc","#3f238d","#800000","#a2651b","#808000","#800080"];return t[(e=_.truncate(e))%t.length]},number_names:{Thousand:Math.pow(10,3),Million:Math.pow(10,6),Billion:Math.pow(10,9),Trillion:Math.pow(10,12),Quadrillion:Math.pow(10,15),Quintillion:Math.pow(10,18),Sextillion:Math.pow(10,21),Septillion:Math.pow(10,24),Octillion:Math.pow(10,27),Nonillion:Math.pow(10,30),Decillion:Math.pow(10,33),Undecillion:Math.pow(10,36),Duodecillion:Math.pow(10,39),Tredecillion:Math.pow(10,42),"*10^45":Math.pow(10,45),"*10^48":Math.pow(10,48),"*10^51":Math.pow(10,51),"*10^54":Math.pow(10,54),"*10^57":Math.pow(10,57),"*10^60":Math.pow(10,60),"*10^63":Math.pow(10,63),"*10^66":Math.pow(10,66),"*10^69":Math.pow(10,69),"*10^72":Math.pow(10,72),"*10^75":Math.pow(10,75),"*10^78":Math.pow(10,78),"*10^81":Math.pow(10,81),"*10^84":Math.pow(10,84),"*10^87":Math.pow(10,87),"*10^90":Math.pow(10,90),"*10^93":Math.pow(10,93),"*10^96":Math.pow(10,96),"*10^99":Math.pow(10,99)},formatNumber:function(e){var t=e<0,n=t?"-":"";if(t&&(e*=-1),e<1e3)return n+e;for(var i in DATA.number_names){var r=DATA.number_names[i];if(r<=e&&e<1e3*r)return n+Number(e/r).toFixed(1)+" "+i}return n+"&infin;"}},FILE={loadURL:function(e,n){var i=new XMLHttpRequest;return i.open("GET",e),i.send(),i.onreadystatechange=function(e){if(4===i.readyState&&200===i.status){var t=i.responseText;null!=t&&""!=t&&MAIN.initializeDataSet(t,n)}},i},process:function(e){if(e)if(_.isFunction(window.FileReader))if(/\.(json|txt)$/.test(e.name)){if(2e4<e.size){var t="This data set is large ("+e.size/1e3+"KB) and may freeze your tab momentarily. Do you want to continue?";if(!confirm(t))return}var n=new FileReader;n.readAsText(e,"UTF-8"),n.onerror=function(e){MSG.error("File could not be read.")},n.onload=function(e){var t=_.target(e).result;MAIN.initializeDataSet(t,!0)}}else MSG.error("Only .json and .txt files are allowed.");else MSG.error("FileReader API is not supported in your browser. Update or switch browsers!");else console.error("File is not defined.")},getObjectFromJSON:function(e){var t=_.parseJSON(e);if(!t)return MSG.error("Could not parse the file as it's not valid JSON."),!1;var n=FILE.isValidData(t);return _.isString(n)?(MSG.error(n,7e3),!1):t},isValidData:function(e){if(void 0===e.name)return'"name" value is not defined.';if(!_.isString(e.name))return'"name" value must be a string.';if(void 0===e.date)return'"date" value must be defined.';if(!_.isString(e.date))return'"date" value must be a string.';if(void 0===e.items)return'"items" value must be defined.';if(_.isEmptyObject(e.items))return'"items" value must contain at least one item.';var t=[];for(var n in e.items)if(e.items.hasOwnProperty.call(e.items,n)){if(t[t.length]=n,void 0===e.items[n].name)return'"name" value in item "'+n+'" is undefined.';if(!_.isString(e.items[n].name))return'"name" value in item "'+n+'" must be a string, but is of type "'+typeof e.items[n].name+'".';if(void 0!==e.items[n].icon&&!_.isString(e.items[n].icon))return'"icon" value in item "'+n+'" must be a string, but is of type "'+typeof e.items[n].icon+'".'}if(void 0===e.range)return'"range" value is not defined.';if(void 0===e.range.from)return'Range "from" value must be defined.';if(!_.isInteger(e.range.from))return'Range "from" value must be a number (integer).';if(void 0===e.range.to)return'Range "to" value is not defined.';if(!_.isInteger(e.range.to))return'Range "to" value must be a number (integer).';if(void 0===e.data)return'"data" value must be defined.';if(_.isEmptyObject(e.data))return'"data" value must contain data for at least one item.';for(var i=t.length,r=0;r<i;r++){var a=t[r];if(_.isEmptyObject(e.data[a]))return'No data points are defined in "'+a+'".';for(var o in e.data[a]){if(!o.match(/^\-?[0-9]+$/g))return'Name "'+o+'" in item "'+a+'" must be a whole number.';if(!_.isNumber(e.data[a][o]))return'Value of "'+o+'" in item "'+a+'" must be a number, but is of type '+typeof e.data[a][o]+"."}}return!0}},VISUALIZER={createCharts:function(){_.removeClass(NODE.ratio_chart_total,"hidden"),_.removeClass(NODE.ratio_chart_container,"hidden");var e=NODE.data_set_info;for(var t in e.title.innerHTML=DATA.name,e.date.innerHTML=DATA.date,_.empty(NODE.bar_chart),_.empty(NODE.ratio_chart),DATA.items)if(DATA.items.hasOwnProperty.call(DATA.items,t)){DATA.html[t]={};var n=VISUALIZER.getBar(t);_.append(NODE.bar_chart,n.container),DATA.html[t].bar_chart=n;var i=VISUALIZER.getRatioPart(t);_.append(NODE.ratio_chart,i.container),DATA.html[t].ratio_chart=i}_.removeClass(NODE.current_value.container,"hidden")},getBar:function(e){var t=DATA.items[e],n={id:e,name:t.name,name_escaped:t.name_escaped,icon:t.icon,color:t.color},i=_.create("button.bar-container"),r=_.create("div.bar"),a=_.create("div.meter",{style:{"background-color":n.color}}),o=_.create("div.name",{innerHTML:n.name}),s=_.create("div.value"),l=_.create("div.clickEvent",{title:"Open line chart for "+n.name_escaped,"item-id":n.id});_.onClick(l,VISUALIZER.openLineChartOnClick);var d=_.create("div.icon",{style:{"background-image":"url("+n.icon+")"}});return _.append(a,o),_.append(a,s),_.append(r,a),_.append(i,d),_.append(i,r),_.append(i,l),{container:i,meter:a,value:s}},getRatioPart:function(e){var t=DATA.items[e],n={id:e,name:t.name,icon:t.icon,color:t.color,mean:DATA.getMean(e),min:DATA.getMin(e),max:DATA.getMax(e)},i=_.create("td.part-container",{style:{"background-color":n.color}}),r=_.create("div.percentage"),a=_.create("div"),o=_.create("button.clickEvent",{title:"Open line chart for "+n.name,"item-id":n.id});_.onClick(o,VISUALIZER.openLineChartOnClick);var s=_.create("div.tooltip"),l=_.create("div.tooltip-percentage"),d=_.create("div.icon",{style:{"background-image":"url("+n.icon+")"}}),c=_.create("div.name",{innerHTML:n.name}),u=_.create("div.description",{innerHTML:"<b>Mean:</b> "+n.mean.formatted+"<br><b>Min:</b> "+n.min.formatted+"<br><b>Max:</b> "+n.max.formatted});return _.append(s,d),_.append(s,l),_.append(s,c),_.append(s,u),_.append(i,s),_.append(r,a),_.append(i,r),_.append(i,o),{container:i,percentage:a,tooltip:s,tooltip_percentage:l}},openLineChartOnClick:function(e){var t=_.target(e).getAttribute("item-id");COMPARE_ITEMS.setItemIds([t]),NAV.showLineChart()}},ANIMATOR={is_running:!1,speed:1,tick:0,loop:null,initialize:function(){_.addEvent(window,"resize",function(){NAV.line_chart_opened&&ANIMATOR.refreshFrame()})},setSpeed:function(e){this.speed=e,this.is_running&&(this.stopLoop(),this.startLoop()),this.setCSSTransitions()},setCSSTransitions:function(){var e=1/this.speed/5+"s";for(var t in DATA.html){var n=DATA.html[t];_.setStyles(n.bar_chart.meter,{transition:e}),_.setStyles(n.ratio_chart.container,{transition:e})}_.setStyles(NODE.current_value.indicator,{transition:e})},startLoop:function(){var e=80/ANIMATOR.speed;ANIMATOR.loop=setInterval(ANIMATOR.update,e)},stopLoop:function(){clearInterval(ANIMATOR.loop),ANIMATOR.loop=null},play:function(){ANIMATOR.is_running=!0,_.removeClass(NODE.html,"animation-paused"),_.addClass(NODE.html,"animation-playing"),ANIMATOR.startLoop(),MSG.show("Started animation.",1e3)},pause:function(){ANIMATOR.is_running=!1,_.removeClass(NODE.html,"animation-playing"),_.addClass(NODE.html,"animation-paused"),ANIMATOR.stopLoop(),MSG.show("Paused animation.",1e3)},restart:function(){ANIMATOR.tick=0},end:function(){ANIMATOR.is_running=!1,ANIMATOR.tick=0,_.removeClass(NODE.html,"animation-playing"),_.addClass(NODE.html,"animation-paused"),ANIMATOR.stopLoop()},stop:function(){1<ANIMATOR.tick&&MSG.show("Stopped animation.",1e3),ANIMATOR.end(),ANIMATOR.update()},update:function(){_.isEmptyObject(DATA.upscaled)||(ANIMATOR.tick>=DATA.upscaled_num?ANIMATOR.end():(ANIMATOR.refreshFrame(),ANIMATOR.tick++))},refreshFrame:function(){if(ANIMATOR.tick%50==0){var e=parseInt(DATA.from)+(0==ANIMATOR.tick?0:ANIMATOR.tick/50);NODE.current_value.value.innerHTML=e,NODE.current_value.indicator.innerHTML=e}_.setStyles(NODE.current_value.indicator,{width:ANIMATOR.tick%50*2+"%"}),NAV.line_chart_opened?ANIMATOR.updateLineChart():(ANIMATOR.sortItems(),ANIMATOR.updateBarChart(),ANIMATOR.updateRatioChart())},items_sorted:[],sortItems:function(){ANIMATOR.items_sorted=[];var e=[],t=-1;for(var n in DATA.items)e[++t]={id:n,value:DATA.upscaled[n][ANIMATOR.tick]};ANIMATOR.items_sorted=_.sortArrayObjects(e,"value",!0)},updateBarChart:function(){var e=ANIMATOR.tick,t=DATA.getTotalMax(e),n=DATA.getTotalMin(e);0<n&&(n=0);for(var i in DATA.items){var r=DATA.upscaled[i][e],a=DATA.formatted[i][e],o=DATA.html[i].bar_chart;o.value.innerHTML=a,_.setStyles(o.meter,{width:(r-n)/(t-n)*100+"%"})}for(var s=0;s<DATA.item_num;s++){i=ANIMATOR.items_sorted[s].id;var l=DATA.html[i].bar_chart.container,d=DATA.items[i].position;_.setStyles(l,{transform:"translate(0, "+52*(s-d)+"px)"})}},updateRatioChart:function(){var e=DATA.total[ANIMATOR.tick];NODE.ratio_chart_total.innerHTML=DATA.formatNumber(e);for(var t=DATA.item_num-1;0<=t;t--){var n=ANIMATOR.items_sorted[t].id,i=100/(e/DATA.upscaled[n][ANIMATOR.tick]),r=DATA.html[n].ratio_chart;if(i<.2)_.addClass(r.container,"hidden");else{_.removeClass(r.container,"hidden"),_.append(NODE.ratio_chart,r.container),_.setStyles(r.container,{width:i+"%"});var a=i.toFixed(1)+"%";r.percentage.innerHTML=a,r.tooltip_percentage.innerHTML=a}}},updateLineChart:function(){var e=NODE.line_chart,t=e.getContext("2d"),n=COMPARE_ITEMS.ids,i=COMPARE_ITEMS.id_num;if(0!=i){e.width=_.getWidth(NODE.line_chart_menu),e.height=500+18*(i-1),t.clearRect(0,0,e.width,e.height);for(var r=0,a=Number.MIN_VALUE,o=0;o<i;o++){var s=n[o],l=DATA.getMin(s).value;l<r&&(r=l);var d=DATA.getMax(s).value;a<d&&(a=d)}var c={top:5,left:5,bottom:80+18*i,right:null},u="12px Arial sans-serif",m=DATA.formatNumber(a)+"",A=DATA.formatNumber(r)+"";t.font=u;var f=t.measureText(m).width,p=t.measureText(A).width;c.right=f,c.right<p&&(c.right=p),c.right+=15,console.log(c.right);var v=e.width-c.right+5;for(o=0;o<2;o++){var h=0==o?m:A,T=0==o?c.top:e.height-c.bottom;t.font=u,t.fillStyle=NAV.darkmode?"#767676":"#b5b5b5",t.textBaseline=0==o?"top":"bottom",t.textAlign="left",t.fillText(h,v,T),t.stroke()}var g=e.width-c.left-c.right,M=e.height-c.bottom+20;for(o=DATA.from;o<=DATA.to;o++){var D=NAV.darkmode?"#242424":"#ededed",E=o==DATA.from?c.left:c.left+g*((o-DATA.from)/(DATA.fixed_num-1)),N=c.top,b=e.height-c.bottom;t.strokeStyle=D,t.moveTo(E,N),t.lineTo(E,b),t.stroke();var O=o+"",S=t.measureText(O).width,w=!1;100<S||(35<S?w=!0:window.innerWidth<=550&&(w=!0),w&&DATA.from!=o&&DATA.to!=o||(t.font=u,t.fillStyle=NAV.darkmode?"#767676":"#b5b5b5",t.textBaseline="bottom",t.textAlign=o==DATA.from?"left":o==DATA.to?"right":"center",t.fillText(O,E,M),t.stroke()))}var I="Arial sans-serif",C=NAV.darkmode?"#767676":"#b5b5b5",R=c.left,y=e.height-c.bottom+50;t.font="14px "+I,t.fillStyle=C,t.textBaseline="middle",t.textAlign="left",t.fillText("Legend",R,y),t.stroke();for(o=0;o<i;o++){var x=COMPARE_ITEMS.ids[o];ANIMATOR.drawLineGraph(e,t,c,x,r,a);var L=DATA.items[x].name_escaped,k=c.left+20,P=e.height-c.bottom+66+18*o;t.font="12px "+I,t.fillStyle=C,t.textBaseline="top",t.textAlign="left",t.fillText(L,k,P),t.stroke();var F=DATA.items[x].color,H=c.left+4;t.fillStyle=F,t.fillRect(H,P,10,10),t.stroke()}if(0!=ANIMATOR.tick&&ANIMATOR.tick!=DATA.upscaled_num-1){var B=(ANIMATOR.tick+1)/DATA.upscaled_num,V=c.left+g*B,G=c.top,z=e.height-c.bottom;t.strokeStyle="#ac6161",t.moveTo(V,G),t.lineTo(V,z),t.stroke()}}else e.width=0},drawLineGraph:function(e,t,n,i,r,a){for(var o=DATA.items[i].color,s=2*Math.PI,l=e.width-n.left-n.right,d=e.height-n.top-n.bottom,c=[],u=0;u<DATA.fixed_num;u++){var m=0==u?0:u/(DATA.fixed_num-1),_=n.left+l*m,A=(DATA.fixed[i][u]-r)/(a-r)*100,f=e.height-n.bottom;f-=d/(100/A),c[c.length]={x:_,y:f}}t.strokeStyle=o;for(u=0;u<c.length;u++){_=c[u].x,f=c[u].y;if(t.beginPath(),t.arc(_,f,2,0,s),t.stroke(),u!=c.length-1){var p=c[u+1].x,v=c[u+1].y;t.moveTo(_,f),t.lineTo(p,v),t.stroke()}}}},MAIN={initializeDataSet:function(e,t){NAV.showBarChart();var n=FILE.getObjectFromJSON(e);COMPARE_ITEMS.resetItemIds(),DATA.set(n),VISUALIZER.createCharts(),t&&_.addClass(NODE.data_load.window,"file-selected"),ANIMATOR.setCSSTransitions(),ANIMATOR.end(),ANIMATOR.refreshFrame()},initialize:function(){NODE.initialize(),NAV.initialize(),DATA_LOAD.initialize(),COMPARE_ITEMS.initialize(),ANIMATOR.initialize(),FILE.loadURL("data/example-data-set.json",!1).onerror=function(){var e=_.create("div.notice.red",{innerHTML:"<b>Loading the example data set failed.</b><br />Are you running this project locally on your system? Try using the <i>Load data</i> button."});_.append(NODE.bar_chart,e);var t=_.create("div.notice.blue",{innerHTML:"You may currently run this project locally on your computer. This restricts you to only load local data set files. You can't load online examples.",style:{"margin-bottom":"20px"}});_.empty(NODE.data_load.example_sets_area),_.append(NODE.data_load.example_sets_area,t)}}};_.onLoad(window,MAIN.initialize);